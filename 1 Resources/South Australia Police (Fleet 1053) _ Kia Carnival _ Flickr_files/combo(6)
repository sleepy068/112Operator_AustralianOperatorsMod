YUI.add("murmurhash",(function(h){h.murmurhash=function(h,r){var a,e,t,c,o,d,n,u;for(a=3&h.length,e=h.length-a,t=r,o=3432918353,d=461845907,u=0;u<e;)n=255&h.charCodeAt(u)|(255&h.charCodeAt(++u))<<8|(255&h.charCodeAt(++u))<<16|(255&h.charCodeAt(++u))<<24,++u,t=27492+(65535&(c=5*(65535&(t=(t^=n=(65535&(n=(n=(65535&n)*o+(((n>>>16)*o&65535)<<16)&4294967295)<<15|n>>>17))*d+(((n>>>16)*d&65535)<<16)&4294967295)<<13|t>>>19))+((5*(t>>>16)&65535)<<16)&4294967295))+((58964+(c>>>16)&65535)<<16);switch(n=0,a){case 3:n^=(255&h.charCodeAt(u+2))<<16;case 2:n^=(255&h.charCodeAt(u+1))<<8;case 1:t^=n=(65535&(n=(n=(65535&(n^=255&h.charCodeAt(u)))*o+(((n>>>16)*o&65535)<<16)&4294967295)<<15|n>>>17))*d+(((n>>>16)*d&65535)<<16)&4294967295}return t^=h.length,t=2246822507*(65535&(t^=t>>>16))+((2246822507*(t>>>16)&65535)<<16)&4294967295,t=3266489909*(65535&(t^=t>>>13))+((3266489909*(t>>>16)&65535)<<16)&4294967295,(t^=t>>>16)>>>0}}),"@VERSION@");YUI.add("moola-manager",(function(e,t){"use strict";var i=require("hermes-core/flog")(t);class n{constructor(t,n){this.initialAdShown=!1,this.adCouldBeShown=!1,this.dwellTime=0,this.contextOwnerIsPro=!1,this.origin={},this.context={},this.timeoutID=0,this.adCallsCounter=0,this.currentlyShowingAd=!1,this.adPosition=1,this.viewerCanSeeAds=null,this.infolinksScriptSource=e.config.flickr.moola.vendors.infolinks.scriptSource,this.infolinksPid=e.config.flickr.moola.vendors.infolinks.pid,this.infolinksWsid=e.config.flickr.moola.vendors.infolinks.wsid,this.infolinksIdName=e.config.flickr.moola.vendors.infolinks.idName,this.infolinksClassName=e.config.flickr.moola.vendors.infolinks.className,t&&n?(this.referrer=t,this.appContext=n):i.error("Attempt to instantiate moola-manager without appContext/referrer")}getAdsSlotsOnPage(){return document.querySelectorAll(".moola-container")}setAdViewStatus(){this.viewerCanSeeAds=!(this.appContext.forceServerRender||this.appContext.flipper.isFlipped("moola_killswitch")||this.appContext.getViewer().signedIn&&this.appContext.getViewer().isPro)}markAdAsSeen(){this.initialAdShown=!0,this.resetPhotoAdsCounter(),this.adCallsCounter--}adIsUnloading(){clearTimeout(this.timeoutID),this.currentlyShowingAd=!1}adIsLoading(){this.currentlyShowingAd=!0}isEnabled(){return null===this.viewerCanSeeAds&&this.setAdViewStatus(),this.viewerCanSeeAds}adNext(){var t,i,n,s,o,r;return!(YUI.Env.isServer||!this.context.current)&&(this.adPosition++,t=this.isEnabled(),i=this.adCouldBeShown,s=this.enoughPhotoViewsAccrued(),n=this.contextOwnerIsPro,o=this.adjacentPhotosAreAdFriendly(),r=this.referrerIsDenied(),t&&i&&s&&!n&&o&&!r&&e.rapidTracker.beacon(this.name,"adSlotAvailable"),t&&i&&!n&&s&&o&&!r)}resetPhotoAdsCounter(){this.appContext.cookieCatcher.setCookieIfAllowed("adCounter",0,{path:"/",domain:"flickr.com"})}enoughPhotoViewsAccrued(){var t=e.Cookie.get("adCounter",Number);return(t=t||0)>=this.getThreshold()}adjacentPhotosAreAdFriendly(){return"next"===this.origin.arrow?this.context.next.adFriendly&&this.context.current.adFriendly:this.context.previous.adFriendly&&this.context.current.adFriendly}referrerIsDenied(){var e=[];return this.appContext.getViewer().signedIn||e.push("/"),e.indexOf(this.appContext.getPreviousURL())>-1}setAdCouldBeShown(e,t,n){void 0===e&&(e=!1),t&&n?(this.origin.arrow=t,this.origin.url=n):e&&(i.info("Attempt to schedule an ad without setting nav direction or URL"),e=!1),this.adCouldBeShown=e}updateContext(t){var i;this.contextOwnerIsPro=!1,(-1!==e.Array.indexOf(["photostream-models","set-models","photoList-models","feed-batch-models"],t.type)||/^\/search\/\?.+=[0-9]+@N[0-9]{2}.*/.test(t.entryURL))&&(i=t.current.getValue("owner"))&&(this.contextOwnerIsPro=i.getValue("isPro")),this.context.previous=this.extractKeyDataFromPhotoModel(t.prev),this.context.current=this.extractKeyDataFromPhotoModel(t.current),this.context.next=this.extractKeyDataFromPhotoModel(t.next)}getThreshold(){var t;try{t=this.initialAdShown?e.config.flickr.moola.threshold[this.referrer].subsequent:e.config.flickr.moola.threshold[this.referrer].initial}catch(e){i.info("There is no matching value for referrer in the ad/referrer config",{referrer:this.referrer,err:e}),t=100}return t}updatePhotoAdsCounter(){var t=e.Cookie.get("adCounter",Number);return t=t||0,this.appContext.cookieCatcher.setCookieIfAllowed("adCounter",++t,{path:"/",domain:"flickr.com"}),t}extractKeyDataFromPhotoModel(e){var t={};return e&&(t={adFriendly:0===e.getValue("safetyLevel"),url:this.getBackgroundImage(e),link:e.getValue("url")}),t}getBackgroundImage(e){var t,i,n,s=40;return t={width:101*(i=this.appContext.getViewer().getPixelRatio()),height:s*i},n={cropToFit:!0,includeSizes:["sq","t","q","s","n"]},e.getSizeToFit(t,n).url}handleInfolinks(e,t){var i=this.appContext.viewportData.getWidth();t||i<735||this.appContext.getViewer().signedIn||this.appContext.getViewer().isPro||e?this.stopInfolinksAdUnit():this.injectInfolinksAdUnit()}injectInfolinksAdUnit(){if(this.infolinksActiveOnPage()||this.infolinksScriptOnPage())window.postMessage(JSON.stringify({message:"RESTORE",apiK:"lJKHQWQlPm"}),"*");else{var e=document.createElement("script");window.infolinks_pid=this.infolinksPid,window.infolinks_wsid=this.infolinksWsid,e.src=this.infolinksScriptSource,e.type="text/javascript",e.classList.add(this.infolinksClassName),e.async=!0,document.body.appendChild(e)}}infolinksActiveOnPage(){var e="#"+this.infolinksIdName;return!!document.querySelector(e)}infolinksScriptOnPage(){var e="."+this.infolinksClassName;return!!document.querySelector(e)}stopInfolinksAdUnit(){this.infolinksActiveOnPage()&&window.postMessage(JSON.stringify({message:"DESTROY",apiK:"lJKHQWQlPm"}),"*")}canShowAd(e){var t=!this.appContext.flipper.isFlipped("moola-killswitch"),i=0===e.getValue("safetyLevel"),n=e.getValue("owner").getValue("isPro"),s=this.appContext.getViewer();return!!t&&(!n&&(!(!n&&!i)&&(!s.signedIn||!s.isPro)))}getHashedAdValue(t){var i=e.config.win.location.href+(e.config.flickr.request?e.config.flickr.request.id:window.reqId)+t+(new Date).getTime().toString()+this.getRandomInteger();return e.murmurhash(i,i+"there is no need to be so salty")}getRandomInteger(){var e=1e11;return Math.floor(9e11*Math.random()+e)}getAdPositioning(e){var t,i,n=e.one(".moola-container");return n&&(i=(t=n.getDOMNode().getBoundingClientRect()).top.toString()+t.right.toString()+t.bottom.toString()+t.left.toString()),i}refreshAdUnit(){this.isEnabled()&&window.asc&&asc.cmd.push((function(){asc.refresh()}))}processAdsOnPage(){this.isEnabled()}destroyAdUnitsOnPage(){}detectAdBlocker(){var e=document.createElement("div"),t=document.querySelector("html");e.className="textads banner-ads banner_ads ad-unit ad-zone ad-space adsbox",e.style.height="1px",document.body.appendChild(e),e.offsetHeight||t.classList.add("user-moola-block"),e.remove()}getAdBlockStatus(){return document.querySelector("html").classList.contains("user-moola-block")}}e.namespace("AdManager"),e.AdManager=n,e.namespace("AscendeumAdManager"),e.AscendeumAdManager=class extends n{constructor(...e){super(...e)}processAdsOnPage(){super.processAdsOnPage(),window.asc&&asc.cmd.push((function(){asc.processAdsOnPage()}))}destroyAdUnitsOnPage(){super.destroyAdUnitsOnPage(),window.asc&&asc.cmd.push((function(){asc.destroy()}))}},e.namespace("NextMilleniumAdManager"),e.NextMilleniumAdManager=class extends n{constructor(...e){super(...e)}processAdsOnPage(){if(super.processAdsOnPage(),paGlobal){this.getAdsSlotsOnPage().forEach((function(e){let t=e.dataset.nmactivated;e.dataset.nmAdunit&&!t&&(paGlobal.directInject(e.dataset.nmAdunit,e),e.setAttribute("data-nmactivated",!0),i.info("Next Millenium: Injected ad "+e.dataset.nmAdunit))}))}}destroyAdUnitsOnPage(){if(super.destroyAdUnitsOnPage(),paGlobal){this.getAdsSlotsOnPage().forEach((function(e){e.dataset.nmId&&(paGlobal.resetUnit(e.dataset.nmId,e),i.info("Next Millenium: Reset ad "+e.dataset.nmId))}))}}},e.namespace("TestAdManager"),e.TestAdManager=class extends n{constructor(...e){super(...e)}processAdsOnPage(){super.processAdsOnPage(),this.getAdsSlotsOnPage().forEach((function(e){e.style="display: flex;justify-content: center;align-items: center;height: 100%;",e.innerHTML='<div style="box-sizing: border-box; background-color: #ff0084; font-size: 20px; padding: 20px; display: flex; justify-content: center; align-items: center; color:white;width: 100%;"> Ad goes here</div>',i.info("Test Ads: Injected test ad")}))}}}),"@VERSION@",{requires:["cookie","io-base","json-parse","murmurhash","url"],optionalRequires:["hermes-core"]});YUI.add("viewport-data",(function(t){"use strict";var i="vp",e=function(e){var o,n,r,h=this;h.appContext=e,(o=e.getCookie(i))&&((n=o.split(",")).length>4?(this.containerWidths=n.slice(4),this.containerWidths=this.containerWidths.map((function(t){return{name:(r=t.split(":"))[0],width:r[1]}}))):this.containerWidths=[]),YUI.Env.isServer?o?(this.viewport={width:parseInt(n[0],10),height:parseInt(n[1],10)},this.density=n[2]?parseFloat(n[2]):1,this.scrollbarWidth=n[3]?parseInt(n[3],10):16):(this.viewport={width:0,height:0},this.density=1,this.scrollbarWidth=16,this.containerWidths=[]):(t.config.win&&(h.density=t.config.win.devicePixelRatio||1,h.scrollbarWidth=t.OverflowHelper.detectScrollbarSize(t.one("body"))),h.setCookieWithCurrentViewportRegion(),h.containerWidths||(h.containerWidths=[]),t.globalEvents.subscribe("window:resize",(function(t){h.setCookieWithCurrentViewportRegion()})))};e.VIEWPORT_COOKIE_NAME=i,e.MAX_NUM_CONTAINER_WIDTHS=20,e.prototype.setCookie=function(){var e,o;!this.viewport.width||this.viewport.width<0||!this.viewport.height||this.viewport.height<0||(e=this.viewport.width+","+this.viewport.height+","+this.density+","+this.scrollbarWidth,t.Lang.isArray(this.containerWidths)&&(o=this.containerWidths.reduce((function(t,i,e,o){return t+=i.name+":"+i.width,e<o.length-1&&(t+=","),t}),""))&&(e=e+","+o),this.appContext.setCookie({cookieName:i,cookieValue:e,path:"/",expiresMonthsFromNow:1}))},e.prototype.setCookieWithCurrentViewportRegion=function(){this.viewport=t.DOM.viewportRegion(),this.setCookie()},e.prototype.getWidth=function(){return this.viewport.width},e.prototype.getHeight=function(){return this.viewport.height},e.prototype.getDevicePixelRatio=function(){return this.density},e.prototype.getScrollbarWidth=function(){return this.scrollbarWidth},e.prototype.getCommonMobileViewportWidth=function(){return 320},e.prototype.getContainerWidth=function(t){var i=0;return this.containerWidths.some((function(e){if(e.name===t)return i=parseInt(e.width,10),!0})),i},e.prototype.setContainerWidth=function(t,i){this.containerWidths.length>=e.MAX_NUM_CONTAINER_WIDTHS&&(this.containerWidths=this.containerWidths.slice(this.containerWidths.length-e.MAX_NUM_CONTAINER_WIDTHS+1)),this.containerWidths.some((function(e){if(e.name===t)return e.width=i,!0}))||this.containerWidths.push({name:t,width:i}),this.setCookie()},t.ViewportData=e}),"@VERSION@");YUI.add("querystring-parse-simple",function(e,t){var n=e.namespace("QueryString");n.parse=function(e,t,r){t=t||"&",r=r||"=";for(var i={},s=0,o=e.split(t),u=o.length,a;s<u;s++)a=o[s].split(r),a.length>0&&(i[n.unescape(a.shift())]=n.unescape(a.join(r)));return i},n.unescape=function(e){return decodeURIComponent(e.replace(/\+/g," "))}},"3.16.0",{requires:["yui-base"]});
YUI.add("browser-support",(function(e,o){var r="Google Page Speed Insights",i=new RegExp(["UP\\.Link","UP\\.Browser","Profile\\/MIDP-","MMP\\/","NetFront","BlackBerry","Danger hiptop","Windows CE","MMP\\/","MIDP","Palm","Nokia","Symbian","iPhone","iPod","Android.+Mobile","Mobile.+Firefox","BB10.+Mobile","webOS","SAMSUNG.+Mobile Safari","SEC_.+Mobile Safari",r+".+Mobile"].join("|"),"i"),n=new RegExp([r].join("|"),"i"),t=new RegExp(["Edge"].join("|"),"i"),s=["facebot","facebook","facebookexternalhit","twitterbot","twitter","pinterest"],a=["bot","crawl","slurp","spider"],u=new RegExp(["Mediapartners-Google","AdsBot-Google","Googlebot","Google Favicon"].join("|"),"i"),c=new RegExp(["bingbot","BingPreview"].join("|"),"i"),f=/Windows NT (?:(?:4|5)\.\d|6\.(?:0|1))/i,p=/(iPhone|iPod|iPad).*AppleWebKit(?!.*Safari)/i,d="Mozilla/4.0 (compatible; MSIE 7.0; Windows NT 10.0; WOW64; Trident/7.0; .NET4.0C; .NET4.0E; .NET CLR 2.0.50727; .NET CLR 3.0.30729; .NET CLR 3.5.30729)",l=function(e){var o;try{o=YUI.Env.parseUA(e)}catch(e){}return o&&o.userAgent?o.userAgent.toLowerCase():""},g=function(e,o){var r,i=!1;if(void 0===e||""===e)return!0;if(o)for(r in o)void 0!==o[r]&&!isNaN(o[r])&&o[r]>0&&(i=!0);return!i};e.mix(e.namespace("BrowserSupport"),{isUnsupportedBrowser:function(e){var o,r=!1;try{o=YUI.Env.parseUA(e)}catch(e){}return!g(e,o)&&(o.safari>=536||o.chrome>=20||o.gecko>=24||o.opera>=15||"android"===o.os||"ios"===o.os&&o.ios>=6||o.ie>11||(r=!0),n.test(o.userAgent)&&(r=!1),e===d||r)},isReallyUnsupportedBrowser:function(e){var o,r=!1;try{o=YUI.Env.parseUA(e)}catch(e){}return!g(e,o)&&(o.safari>=533.21||o.chrome>=13||o.gecko>=2||(e||"").indexOf("Firefox/4.0")>-1||o.opera>=12||"android"===o.os||"ios"===o.os&&o.ios>=4||o.ie>=9||(r=!0),e!==d&&r)},isMobileBrowser:function(e){try{var o=YUI.Env.parseUA(e);return!o.ipad&&((!o.mobile||!/Nexus 10/.test(o.userAgent))&&(!!o.mobile||i.test(o.userAgent)))}catch(e){}return!1},isMobileOrTablet:function(e){try{var o=YUI.Env.parseUA(e);return!!o.mobile||i.test(o.userAgent)}catch(e){}return!1},isBot:function(e){var o,r=!1;return o=l(e),a.some((function(e){return o.indexOf(e)>-1&&(r=!0,!0)})),r},isSharingBot:function(e){var o,r=!1;return o=l(e),s.some((function(e){return o.indexOf(e)>-1&&(r=!0,!0)})),r},isFacebook:function(e){var o=!1;return l(e).indexOf("facebookexternalhit/1.1")>-1&&(o=!0),o},isGoogle:function(e){return u.test(l(e))},isBing:function(e){return c.test(l(e))},getOSString:function(e){var o,r="";try{o=YUI.Env.parseUA(e)}catch(e){}return e&&e.indexOf("Windows Phone")>-1?r="windows":o&&o.os&&(r=o.os.toLowerCase()),r},isWebview:function(e){return p.test(e)},isGooglePageSpeedToolMobile:function(e){return new RegExp(r+".+Mobile").test(e)},isGooglePageSpeedToolDesktop:function(e){return new RegExp(r).test(e)},isEdge:function(e){return new RegExp(t).test(e)},isOldWindows:function(e){return f.test(e)}})}),"@VERSION@",{requires:[]});YUI.add("pluginhost-base",function(e,t){function r(){this._plugins={}}var n=e.Lang;r.prototype={plug:function(e,t){var r,i,s;if(n.isArray(e))for(r=0,i=e.length;r<i;r++)this.plug(e[r]);else e&&!n.isFunction(e)&&(t=e.cfg,e=e.fn),e&&e.NS&&(s=e.NS,t=t||{},t.host=this,this.hasPlugin(s)?this[s].setAttrs&&this[s].setAttrs(t):(this[s]=new e(t),this._plugins[s]=e));return this},unplug:function(e){var t=e,r=this._plugins;if(e)n.isFunction(e)&&(t=e.NS,t&&(!r[t]||r[t]!==e)&&(t=null)),t&&(this[t]&&(this[t].destroy&&this[t].destroy(),delete this[t]),r[t]&&delete r[t]);else for(t in this._plugins)this._plugins.hasOwnProperty(t)&&this.unplug(t);return this},hasPlugin:function(e){return this._plugins[e]&&this[e]},_initPlugins:function(e){this._plugins=this._plugins||{},this._initConfigPlugins&&this._initConfigPlugins(e)},_destroyPlugins:function(){this.unplug()}},e.namespace("Plugin").Host=r},"3.16.0",{requires:["yui-base"]});
YUI.add("pluginhost-config",function(e,t){var n=e.Plugin.Host,r=e.Lang;n.prototype._initConfigPlugins=function(t){var n=this._getClasses?this._getClasses():[this.constructor],r=[],i={},s,o,u,a,f;for(o=n.length-1;o>=0;o--)s=n[o],a=s._UNPLUG,a&&e.mix(i,a,!0),u=s._PLUG,u&&e.mix(r,u,!0);for(f in r)r.hasOwnProperty(f)&&(i[f]||this.plug(r[f]));t&&t.plugins&&this.plug(t.plugins)},n.plug=function(t,n,i){var s,o,u,a;if(t!==e.Base){t._PLUG=t._PLUG||{},r.isArray(n)||(i&&(n={fn:n,cfg:i}),n=[n]);for(o=0,u=n.length;o<u;o++)s=n[o],a=s.NAME||s.fn.NAME,t._PLUG[a]=s}},n.unplug=function(t,n){var i,s,o,u;if(t!==e.Base){t._UNPLUG=t._UNPLUG||{},r.isArray(n)||(n=[n]);for(s=0,o=n.length;s<o;s++)i=n[s],u=i.NAME,t._PLUG[u]?delete t._PLUG[u]:t._UNPLUG[u]=i}}},"3.16.0",{requires:["pluginhost-base"]});
YUI.add("base-pluginhost",function(e,t){var n=e.Base,r=e.Plugin.Host;e.mix(n,r,!1,null,1),n.plug=r.plug,n.unplug=r.unplug},"3.16.0",{requires:["base-base","pluginhost"]});
YUI.add("template-base",function(e,t){function n(t,n){this.defaults=n,this.engine=t||e.Template.Micro,this.engine||e.error("No template engine loaded.")}n._registry={},n.register=function(e,t){return n._registry[e]=t,t},n.get=function(e){return n._registry[e]},n.render=function(t,r,i){var s=n._registry[t],o="";return s?o=s(r,i):e.error('Unregistered template: "'+t+'"'),o},n.prototype={compile:function(t,n){return n=n?e.merge(this.defaults,n):this.defaults,this.engine.compile(t,n)},precompile:function(t,n){return n=n?e.merge(this.defaults,n):this.defaults,this.engine.precompile(t,n)},render:function(t,n,r){return r=r?e.merge(this.defaults,r):this.defaults,this.engine.render?this.engine.render(t,n,r):this.engine.compile(t,r)(n,r)},revive:function(t,n){return n=n?e.merge(this.defaults,n):this.defaults,this.engine.revive?this.engine.revive(t,n):t}},e.Template=e.Template?e.mix(n,e.Template):n},"3.16.0",{requires:["yui-base"]});
YUI.add("history-helper",(function(t,e){var r=require("hermes-core/flog")(e);t.HistoryHelper={setData:function(t,e,i){var o={};if("undefined"!=typeof history&&history.replaceState){void 0!==history.state&&null!==history.state&&void 0!==history.state.flickr&&(o=history.state.flickr),void 0===o[t]&&(o[t]={}),o[t][e]=i;try{history.replaceState({flickr:o},"")}catch(t){}return!0}return r.warn("Failed attempt to store history data",{namespace:t,key:e}),!1},getData:function(t,e){var r;if("undefined"!=typeof history&&void 0!==history.state&&null!==history.state&&void 0!==history.state.flickr&&void 0!==(r=history.state.flickr[t])&&void 0!==r[e])return r[e]}}}),"@VERSION@",{requires:[],optionalRequires:["hermes-core"]});YUI.add("flickr-view",(function(e,i){var t=require("hermes-core/flog")(i);e.FlickrView=e.Base.create("flickrView",e.Base,[],{viewState:null,subviews:{},subviewConfig:null,_eventHandles:null,initializer:function(e){return this.appContext=e.appContext,delete e.appContext,""===this.get("container").get("innerHTML")&&this.setContainerHTML(""),this.set("headContainer",""),this.isBuilt=!1,this.isActivated=!1,this.isErrorBuilt=!1,this.subviewsWithLoadingError={},this._params=e||{},this.isMobile=e.isMobile,this.subviews={},this._eventHandles=[],this.appContext&&!this.appContext.viewTiming&&(this.appContext.viewTiming={}),this.appContext&&(this.appContext.viewTiming[this.name]={initialize:0,loadState:0,buildContainer:0,buildHeadContainer:0,activate:0}),this},initialize:function(i){var r=this;return this.initializeStartTime=Date.now(),this.isErrorBuilt=!1,this.serverRendered=!(!i||!i.serverRendered)&&i.serverRendered,r.beforeDestroy&&(r.beforeDestroyHandler=r.before("destroy",r.beforeDestroy)),YUI.Env.isServer||this.registerEventHandler(this.appContext.flapp.after("activeViewChange",(function(e){r.normalizedActivate()}))),this.on("parentViewEvent",this.handleParentViewEvent.bind(this,this.name)),this.setupSubviews().then((function(){var e,i;if(r.isErrorBuilt){if(r.error.is404)throw r.error;throw i=new Error("Subview of "+r.name+" causing loadState error"),r.error&&(i.message+=": "+r.error.message,r.error.method&&(i.message+=", method="+r.error.method),i.message+=" | subview failure: "+r.error.fatal,r.error.wasDealbreaker&&(i.message+=" dealbreaker failed "),r.error.wasMultipleSubviews&&(i.message+=" multiple subviews failed "),i.fatal=r.error.fatal),i}if(r.loadStateTimingStart=Date.now(),!(e=r.loadState()))throw new Error("View "+r.name+" loadState function does not return a promise");return e})).then((function(){if(r.appContext&&r.appContext.viewTiming&&r.appContext.viewTiming[r.name]&&(r.appContext.viewTiming[r.name].loadState=Date.now()-r.loadStateTimingStart),YUI.Env.isServer||!r.get("container").hasClass("requiredToShowOnServer")||i&&i.wasDeferred){var e=Date.now();try{r.buildContainer()}catch(e){throw t.error("Error building",{topic:r.name,err:e}),r.fire("loadingError",{message:e.message,fatal:!0,wasDealbreaker:!0}),r.buildErrorContainer(),r.isErrorBuilt=!0,e}if(r.appContext&&r.appContext.viewTiming&&r.appContext.viewTiming[r.name]&&(r.appContext.viewTiming[r.name].buildContainer=Date.now()-e),r.get("isRootView")){r._buildFullRootViewAdditionalViewClasses();var n=r.get("rootViewAdditionalViewClasses");n&&n.length>0&&r.get("container").addClass(n.join(" "))}}r.isBuilt=!0,r.isErrorBuilt=!1,r.fire("loadingSuccess")}),(function(e){throw r.fire("loadingError",{message:e.message,fatal:e.fatal,is404:e.is404,wasMultipleSubviews:e.wasMultipleSubviews,wasDealbreaker:e.wasDealbreaker}),r.buildErrorContainer(),r.isErrorBuilt=!0,t.error("Error loading state",{topic:r.name,err:e}),e})).then((function(){var e,i;return r.isErrorBuilt||r.get("isActiveViewAgnostic")||(e=Date.now(),r._buildFullHeadMeta(),r.buildHeadContainer=Date.now()-e),YUI.Env.isServer||(r.shouldDeferSubviews&&r._setupDeferredSubviewsInitialization(),i=Date.now(),r.normalizedActivate(),r.appContext&&r.appContext.viewTiming&&r.appContext.viewTiming[r.name]&&(r.appContext.viewTiming[r.name].activate=Date.now()-i)),r.appContext&&r.appContext.viewTiming&&r.appContext.viewTiming[r.name]&&(r.appContext.viewTiming[r.name].initialize=Date.now()-r.initializeStartTime),r}),(function(e){throw YUI.Env.isServer||(r.shouldDeferSubviews&&r._setupDeferredSubviewsInitialization(),r.normalizedActivate()),e})).catch(e.PromiseCatcher(this.name))},render:function(){return this},buildHeadContainer:function(){return this.set("headContainer",""),this},_buildSubviewHeadContainers:function(){var e=[],i=this,t="<script";return Object.keys(this.subviews).forEach((function(t){-1===e.indexOf(i.subviews[t].get("headContainer"))&&e.push(i.subviews[t].get("headContainer"))})),e.sort((function(e,i){var r=e.toLowerCase().indexOf(t)>-1,n=i.toLowerCase().indexOf(t)>-1;return r&&!n?1:!r&&n?-1:0})).join("")},_buildFullHeadMeta:function(){var e;return this.buildHeadContainer(),e=(e=this.get("headContainer")).concat(this._buildSubviewHeadContainers()),this.set("headContainer",e.concat("")),this},setRootViewAdditionalViewClasses:function(){return this.set("rootViewAdditionalViewClasses",[]),this},_buildFullRootViewAdditionalViewClasses:function(){var e=[];return e=e.concat(this._buildSubviewRootViewAdditionalViewClasses()),this.set("rootViewAdditionalViewClasses",e),this},_buildSubviewRootViewAdditionalViewClasses:function(){this.setRootViewAdditionalViewClasses();var e=this.get("rootViewAdditionalViewClasses")||[],i=this;return Object.keys(this.subviews).forEach((function(t){var r=i.subviews[t]._buildSubviewRootViewAdditionalViewClasses();e=e.concat(r)})),e},_setupDeferredSubviewsInitialization:function(){setTimeout(function(){var i=e.config.win.document.body;i.scrollTop>0||i.clientHeight-50<=i.scrollHeight?this._loadDeferredSubviews():(this.deferredViewScrollListener=e.globalEvents.subscribe("window:scroll",this._loadDeferredSubviews.bind(this)),this.registerEventHandler(this.deferredViewScrollListener))}.bind(this),10)},_loadDeferredSubviews:function(){this.loadingDeferred||(this.loadingDeferred=!0,this._removeDeferredViewScrollListener(),this._recursivelyLoadDeferredSubview(0,!1))},_removeDeferredViewScrollListener:function(){this.deferredViewScrollListener&&(this.deferredViewScrollListener.detach(),this.deferredViewScrollListener=null)},_recursivelyLoadDeferredSubview:function(i,r){var n=Object.keys(this.subviewConfig||[]).filter(function(e){var i=this.subviewConfig[e];return!0!==i.disabled&&(("function"!=typeof i.disabled||!i.disabled.call(this,this._params))&&this.subviewConfig[e].canDefer)}.bind(this)),a=this;if(i<=n.length-1){var s,o=n[i],u=e.merge(this._params,this.subviewConfig[o]);u.container=null,u.wasDeferred=!0,t.log("Loading deferred view",{topic:a.name,view:o});try{s=this.appContext.getView(o,u)}catch(e){return void this._onDeferredViewLoadingError(i,r,e)}s.then((function(e){if(!e)return t.error("An error occured trying to load the deferred view.",{topic:a.name}),r?(i++,r=!1):r=!0,void a._recursivelyLoadDeferredSubview(i,r);e.initialize(u).then((function(){e.on("subviewViewEvent",(function(i){i&&i.details&&i.details.length&&a.onSubviewEvent.call(a,e.name,i.details)})),u&&u.additionalViewClasses&&u.additionalViewClasses.forEach((function(i){e.get("container").addClass(i)})),a._addDeferredViewToDOM(e),e.normalizedActivate(),i++,a._recursivelyLoadDeferredSubview(i,!1)})).catch(a._onDeferredViewLoadingError.bind(this,i,r))}))}},_onDeferredViewLoadingError:function(e,i,r){t.error("An error occured trying to initialize the deferred view",{topic:this.name,err:r}),i?(e++,i=!1):i=!0,this._recursivelyLoadDeferredSubview(e,i)},_addDeferredViewToDOM:function(e){if(e){var i=this.get("container").one("."+e.name),r=e.get("container");i&&r?i.replace(r):t.error("Could not add view to DOM in _addDeferredViewToDOM",{topic:this.name,view:e.name})}else t.error("Non-view passed to _addDeferredViewToDOM.",{topic:this.name})},attachKeyEvent:function(e,i,t){return this.registerEventHandler(this.appContext.getKeyboardManager().on(e,t||this._params.keyEventScope||"*",i.bind(this)))},setContainerHTML:function(e){var i=this;return this.get("container").setHTML(e),YUI.Env.isServer||(this.get("container").generateID(),Object.keys(this.subviews||{}).forEach((function(e,t,r){var n=i.subviews[e],a=n.get("container"),s=n.getId?n.getId():a._yuid,o=i.get("container").one("#"+s);o&&o.replace(a)}))),this},setupSubviews:function(){var i,r=this,n=[],a=[],s=[],o=this.appContext.flipper.isFlipped("enable-non-blocking-on-non-required-views"),u={};return this.subviewConfig?(Object.keys(this.subviewConfig).forEach((function(e){!0!==r.subviewConfig[e].disabled&&("function"==typeof r.subviewConfig[e].disabled&&r.subviewConfig[e].disabled.call(r,r._params)||(u[e]=r.subviewConfig[e]))})),Object.keys(u).map((function(l){i=YUI.Env.isServer?u[l].requiredToShowOnServer||u[l].requiredToShow||r.appContext.forceServerRender&&!u[l].neverShowOnServer:u[l].requiredToShowOnClient||u[l].requiredToShow;var c=e.merge(r._params,u[l]);if(!r.shouldDeferSubviews&&c.canDefer&&delete c.canDefer,r.shouldDeferSubviews&&c.canDefer)t.log("Deferring subview.",{topic:r.name,view:l}),(o?s:n).push(r.instantiateSubview(l,c).then((function(e){return e.setContainerHTML(""),e.get("container").addClass("deferred-view"),e})));else if(i){(o?a:n).push(r.instantiateSubview(l,c).then((function(e){return e.wasRequiredToShow=!0,r.setupSubview(l,c,e)})))}else{(o?s:n).push(r.instantiateSubview(l,c).then((function(i){i.wasRequiredToShow=!1,YUI.Env.isServer||e.soon((function(){r.setupSubview(l,c,i)}))})))}})).filter((function(e){return!!e})),o?(a.length?e.Promise.all(a):e.Promise.resolve()).then((function(){s.length&&!YUI.Env.isServer&&e.Promise.all(s).then((function(){r.buildContainer(),r.normalizedActivate()}))})):n.length?e.Promise.all(n):e.Promise.resolve()):e.Promise.resolve()},registerSubview:function(e,i){i||(i=e.name),this.subviews[i]=e},instantiateSubview:function(i,r){var n=this;return r.container=this.getContainer({isSubview:!0,subviewName:i,subviewParams:r}),this.appContext.getView(i,r).then(null,(function(){return t.log("getView failed to load view, retrying once more."),n.appContext.getView(i,r)})).then((function(e){return e.on("loadingError",n.handleSubviewLoadingError.bind(n)),e.on("loadingSuccess",n.handleSubviewLoadingSuccess.bind(n)),e.on("subviewViewEvent",n.handleSubviewEvent.bind(n,e.name)),n.registerSubview(e,i),e._params&&(e._params.keyEventScope=n._params.keyEventScope),e})).catch(e.PromiseCatcher(this.name))},onSubviewEvent:function(e,i){return!0},onParentViewEvent:function(e,i){return!0},handleSubviewEvent:function(e,i){var t=i&&i.details||[];!1!==this.onSubviewEvent(e,t)&&this.fire.apply(this,["subviewViewEvent"].concat(t))},handleParentViewEvent:function(e,i){var t,r=i&&i.details||[];if(!1!==this.onParentViewEvent(e,r))for(t in this.subviews)this.subviews[t].fire.apply(this.subviews[t],["parentViewEvent"].concat(r))},handleSubviewLoadingSuccess:function(e){this.subviewsWithLoadingError[e.target.name]&&delete this.subviewsWithLoadingError[e.target.name]},handleSubviewLoadingError:function(e){var i;this.subviewConfig[e.target.name].dealbreaker&&(this.hasDealbreakerSubviewLoadingError=!0),this.subviewsWithLoadingError[e.target.name]=e.details[0],this.isErrorBuilt||(i=Object.keys(this.subviewsWithLoadingError),(this.hasDealbreakerSubviewLoadingError||i.length>=2)&&(this.error={message:"",fatal:!0},i.forEach(function(e,t){var r=this.subviewsWithLoadingError[e];t!==i.length-1?this.error.message+="["+e+"] "+r.message+" | ":this.error.message+="["+e+"] "+r.message,r.is404&&(this.error.is404=!0),r.method&&(this.error.method+=r.method),r.fatal||(this.error.fatal=!1)}.bind(this)),this.fire("loadingError",{message:this.error.message,fatal:this.error.fatal,is404:this.error.is404,wasDealbreaker:this.hasDealbreakerSubviewLoadingError,wasMultipleSubviews:i&&i.length>=2}),this.buildErrorContainer(),this.isErrorBuilt=!0,t.error("subview forced the error loading state",{topic:this.name,view:e.target.name})))},setupSubview:function(i,r,n){var a=this;return(r=e.merge(r||{})).alreadyRendered=a.alreadyRendered,n.set("isActiveViewAgnostic",a.get("isActiveViewAgnostic")),n.initialize(r).then((function(){return a.subviews[i]}),(function(e){t.error("Error getting/initializing view",{topic:a.name,err:e,view:i})})).catch(e.PromiseCatcher(this.name))},attachEvents:function(i){if(i){var t={},r=this;Object.keys(i).forEach((function(n){var a,s;a={selector:(n.match(/([\w-_#\.\[\]~|$^*= ]+) /i)||[])[1]||"[data-action]",type:(n.match(/([\w]+):/i)||[])[1]||"click",action:(n.match(/:([\w]+)/i)||[])[1]||"_default_"},t[s=a.selector+"/"+a.type]||(t[s]={},r.registerEventHandler(r.get("container").delegate(a.type,(function(i){var n,o,u,l;if(n=i.target.ancestor(a.selector,!0),"click"===a.type&&(o=i.target.ancestor(".server-only-link",!0)))return!0===i.metaKey||!0===i.ctrlKey?void 0:void(e.config.win.location=o.get("href"));if(n&&(l=(u=n.getData()||{}).action||"_default_",t[s].hasOwnProperty(l))){if(!t[s][l])throw new Error('Handler for "'+l+'" UI event is undefined');t[s][l].call(r,i,u)}}),a.selector))),t[s][a.action]=i[n]}))}},registerEventHandler:function(i){if(e.Lang.isFunction(i.detach))return this._eventHandles.push(i),i},detachRegisteredEvent:function(i){var t=this._eventHandles.indexOf(i);-1!==t&&e.Lang.isFunction(i.detach)&&(i.detach(),this._eventHandles.splice(t,1))},detachRegisteredEvents:function(){this._eventHandles.length&&(this._eventHandles.forEach((function(e){e.detach()})),this._eventHandles=[])},generateSignature:function(i,t){var r={},n=function(e){var i=0;if(0===e.length)return i;for(var t=0;t<e.length;t++)i=(i<<5)-i+e.charCodeAt(t),i&=i;return i};return e.Object.each(t,(function(e,i){"container"!==i&&"appContext"!==i&&"context"!==i&&"cspNonce"!==i&&"parentView"!==i&&"keyEventScope"!==i&&void 0!==e&&"function"!=typeof e&&(r[i]="object"==typeof e?1:e)})),i+"__"+Object.keys(r).sort().map((function(e){var i,t;try{i=encodeURIComponent(e)}catch(t){i=encodeURIComponent(n(e))}try{t=encodeURIComponent(r[e])}catch(t){i=encodeURIComponent(n(r[e]))}return i+"_"+t})).join("__")},getContainer:function(i){(i=i||{}).subviewParams=i.subviewParams||{};var t,r,n,a,s=["view",i.subviewName||i.viewName||this.name],o=i.subviewName?i.subviewParams.additionalViewClasses:this.additionalViewClasses,u=i.subviewParams.preferredViewTag||"div";return(!i.isSubview||i.subviewParams.requiredToShowOnServer||i.subviewParams.requiredToShow)&&YUI.Env.isServer&&s.push("requiredToShowOnServer"),this.theme&&s.push(this.theme),e.Lang.isArray(o)&&o.length?s=s.concat(o):e.Lang.isFunction(o)&&(a=o.call(this),e.Lang.isArray(a)&&a.length&&(s=s.concat(a))),i.subviewName||s.push(e.FlickrView.ROOT_VIEW_CLASS_NAME),s=' class="'+s.join(" ")+'"',i.subview?t=i.subview.getId():i.subviewName&&i.subviewParams&&(t=this.generateSignature(i.subviewName,i.subviewParams)),YUI.Env.isServer?r={html:"",setHTML:function(e){this.html=e},getHTML:function(e){return this.html},get:function(e){switch(e){case"innerHTML":return this.html;case"outerHTML":return"<"+u+" "+s+(n?' style="'+Object.keys(n).reduce((function(e,i,t,r){return e+i+": "+n[i]+(t<r.length-1?"; ":"")}),"")+'"':"")+(t?' data-view-signature="'+t+'"':"")+">"+this.html+"</"+u+">"}return null},hasChildNodes:function(){return!1},addClass:function(e){""!==(e=e.trim())&&(s=s.slice(0,-1)+" "+e+'"')},hasClass:function(e){return s.split('"')[1].split(" ").indexOf(e)>-1},removeClass:function(e){var i=s.split('"')[1].split(" "),t=i.indexOf(e);-1!==t&&(i.splice(t,1),s=' class="'+i.join(" ")+'"')},setStyle:function(e,i){n||(n={}),n[e]=i},setStyles:function(e){n||(n={}),Object.keys(e).forEach((function(i){n[i]=e[i]}))},appendChild:function(e){this.html+=e.html},all:function(){return{each:function(){}}},one:function(){return null}}:(t&&(r=this.get("container").one('[data-view-signature="'+t+'"]')),r?r.removeAttribute("data-view-signature"):r=e.Node.create("<"+u+" "+s+"></"+u+">")),r},renderSubviews:function(){var e=this;return Object.keys(this.subviews).forEach((function(i,r,n){try{e.subviews[i].render()}catch(r){t.error("Error rendering view",{topic:e.name,err:r,view:i})}})),{}},templates:function(i){var r,n=e.Template.get("hermes/"+i),a=this.getLangBundles(),s=this;if(a.locales=this.appContext.lang||this.defaultLang,"function"!=typeof n)throw t.error("Template not found",{topic:this.name,template:i}),new Error("Template not found: "+i);return this.appContext.flipper&&(r=this.appContext.flipper),function(e){return!(e=e||{}).flippers&&r&&(e.flippers=r.toJSON()),e.isMobile=s._params.isMobile,e.cspNonce=s._params.cspNonce,s.appContext.forceServerRender&&(e.isServerRendered=!0),Object.keys(s.subviewConfig||{}).forEach((function(i){e[i]||(e[i]=s.subviews[i]?s.subviews[i].get("container"):"")})),n(e,{data:{intl:a,flippers:e.flippers}})}},loadState:function(){return e.Promise.resolve()},updateHead:function(){null!==this.get("headContainer")&&(e.one("head").all('[data-dynamic="true"]').remove(!0),e.one("head").append(this.get("headContainer")))},canActivate:function(){var e=!1;return(this.isBuilt||this.isErrorBuilt)&&(this.isActivated||this.isErrorActivated||this.isActiveAndInDOM()&&(e=!0)),e},isActiveAndInDOM:function(){var e=this.get("container");return e&&(this.get("isActiveViewAgnostic")||this.appContext.flapp.get("activeView").get("container").contains(e))&&e.inDoc()},activate:function(){return this},activateSubviews:function(){var e,i;for(e in this.subviews){i=this.subviews[e];try{i.normalizedActivate(),i.recursivelyActivateSubviews()}catch(i){t.error("Error activating view",{topic:this.name,err:i,view:e})}}return this},recursivelyActivateSubviews:function(e){var i,r,n=e||this.subviews;for(i in n)if((r=n[i]).canActivate()){r.normalizedActivate();try{r.normalizedActivate(),this.recursivelyActivateSubviews(r.subviews)}catch(e){t.error("Error activating view",{topic:this.name,err:e,view:r})}}return this},normalizedActivate:function(){this.canActivate()&&(this.isErrorBuilt?(this.isErrorActivated=!0,this.activateErrorContainer()):(this.activate(),this.isActivated=!0,this.activateSubviews()))},onCSSLoaded:function(i){var t=this;this.appContext.isCSSLoaded?i.call(t):this.registerEventHandler(e.on("css-loaded",(function(){i.call(t)})))},buildErrorContainer:function(){this.setContainerHTML("")},activateErrorContainer:function(){var e=this,i=this.get("container").one(".retry");i&&i.on("click",(function(i){i.preventDefault(),e.isErrorActivated=!1,e.initialize()}))},setViewDataOnHistory:function(i,t){return e.HistoryHelper.setData(this.name,i,t)},getViewDataFromHistory:function(i){return e.HistoryHelper.getData(this.name,i)},getTrackingSegments:function(){return{}},updateDataLayer:function(){},reload:function(i,t){var r=this,n=[];if(!i.length)return e.Promise.resolve();for(var a=0;a<i.length;a++)n.push(this.appContext.getModelRegistry(i[a]));return e.Promise.all(n).then((function(e){for(var i=0;i<e.length;i++)Array.isArray(t)?e[i].remove(t[i]):e[i].remove(t);YUI.Env.isServer||r.appContext.flapp.navigate(r.appContext.getLocation().href)})).catch(e.PromiseCatcher(this.name))},destroy:function(i){this.set("destroyed",!0);var t,r=this.get("container");if(this.detachRegisteredEvents(),!YUI.Env.isServer&&this.isActiveAndInDOM()){this.setRootViewAdditionalViewClasses();var n=this.get("rootViewAdditionalViewClasses")||[],a=e.one("."+e.FlickrView.ROOT_VIEW_CLASS_NAME);n&&a&&n.forEach((function(e){a.removeClass(e)}))}return this._removeDeferredViewScrollListener(),e.Node&&r&&(r.detach&&r.detach(),i&&(i.remove||i.delete)&&r.remove&&r.remove(!0),this.set("container",null)),this.destroySubviews(),t=e.FlickrView.superclass.destroy.call(this),this.beforeDestroyHandler&&this.beforeDestroyHandler.detach(),t},destroySubviews:function(){var e=this;Object.keys(this.subviews||{}).forEach((function(i,t,r){e.subviews[i].destroy()}))},bringIntoFocus:function(){var e=this.get("container"),i=e.getAttribute("tabindex")||null;e.setAttribute("tabindex","-1"),e.focus(),e.blur(),i?e.setAttribute("tabindex",i):e.removeAttribute("tabindex")},setContainerWithTemplate:function(e,i){this.setContainerHTML(this.templates(e)(i))},getAdditionalSpContexts:function(){return[]},godMessage:e.godMessage},{ATTRS:{container:{value:"",setter:function(e){return e||this.getContainer()}},trackedElementIDs:{value:[],validator:function(i){return e.Lang.isArray(i)}},rapidConf:{value:{},validator:function(i){return e.Lang.isObject(i)}},isActiveViewAgnostic:{value:!1},isRootView:{value:!1},rootViewAdditionalViewClasses:{value:[],validator:function(i){return e.Lang.isArray(i)}},isCSSLoaded:{getter:function(){return!!this.appContext.isCSSLoaded}}},create:function(i,r,n,a,s){e.namespace("Views"),e.Views[i]&&t.warn("A view with this name already exists. Did you mean to redefine it?",{view:i}),a.destroy&&a.destroy!==e.FlickrView.prototype.destroy&&t.warn("`destroy` method was overridden. Did you mean `destructor`?",{view:i}),a.initialize&&a.initialize!==e.FlickrView.prototype.initialize&&t.warn("`initialize` method was overridden. Did you mean `initializer`?",{view:i});try{e.Views[i]=e.Base.create(i,r,n,a,s)}catch(r){throw t.warn("`Base.create` method failed, maybe because of Chrome 51?",{view:i}),!YUI.Env.isServer&&e.config.win.beaconError&&e.config.win.beaconError("`Base.create` method failed, maybe because of Chrome 51?",e.config.win.location.href,r),r}if(r&&r!==e.FlickrView&&r.prototype&&r.prototype.langBundles){var o,u=(e.Views[i].prototype.langBundles||[]).concat(r.prototype.langBundles);o=e.Array.dedupe(u),e.Views[i].prototype.langBundles=o}return e.Views[i]},ROOT_VIEW_CLASS_NAME:"flickr-view-root-view"}),e.mix(e.FlickrView.prototype,e.Localizable)}),"@VERSION@",{requires:["base","template-base","flickr-promise","handlebars-base","handlebars-helpers","localizable","history-helper","god-message"],optionalRequires:["hermes-core"]});YUI.add("banner-view",(function(i,e){require("hermes-core/flog")(e);i.FlickrView.create(this.name,i.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(i){this.params=i,this.subview=this.params.subview},loadState:function(){return i.Promise.resolve()},buildContainer:function(){},activate:function(){var e=this,t=this.get("container");return this.subviewParent=t,this.subview?(this.subview.on("dismiss",(function(t){if(i.Snowplough){var s={category:"banner",action:"dismiss",label:e.subview.name};t.property&&(s.property=t.property),t.value&&(s.value=t.value),i.Snowplough.sendStructuredEvent(s)}e.dismiss()})),this.subview.initialize().then((function(){return e.setupSubview()}))):this},setupSubview:function(){var i=this,e=i.subview.get("container");return i.subviewParent.empty(),i.subviewParent.appendChild(e),i.subview.on("activated",(function(){i.fire("subviewActivated")})),i.subview.activate()},dismiss:function(){this.fire("dismissed")},handleContainerClose:function(){this.subview&&this.subview.close&&this.subview.close()}})}),"@VERSION@",{requires:["flickr-view"],optionalRequires:["hermes-core"],langBundles:["common"]});