YUI.add("hermes-template-sub-photo-person",(function(n,l){var e=n.Template.Handlebars.revive({1:function(n,l,e,t,a){var o,r,s=null!=l?l:n.nullContext||{},i=n.hooks.helperMissing,c="function",u=n.escapeExpression,p=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return'\t<li class="person '+(null!=(o=p(e,"if").call(s,null!=l?p(l,"showRemove"):l,{name:"if",hash:{},fn:n.program(2,a,0),inverse:n.noop,data:a,loc:{start:{line:2,column:19},end:{line:2,column:58}}}))?o:"")+'" '+(null!=(o=p(e,"if").call(s,null!=l?p(l,"dataAttr"):l,{name:"if",hash:{},fn:n.program(4,a,0),inverse:n.noop,data:a,loc:{start:{line:2,column:60},end:{line:2,column:125}}}))?o:"")+'>\n\t\t<div class="tag-content">\n\t\t\t<div class="circle-icon" data-person-nsid="'+u(typeof(r=null!=(r=p(e,"nsid")||(null!=l?p(l,"nsid"):l))?r:i)===c?r.call(s,{name:"nsid",hash:{},data:a,loc:{start:{line:4,column:46},end:{line:4,column:54}}}):r)+'">\n\t\t\t\t<img class="show-person-menu" src="'+(null!=(o=p(e,"if").call(s,null!=(o=null!=l?p(l,"buddyicon"):l)?p(o,"default"):o,{name:"if",hash:{},fn:n.program(6,a,0),inverse:n.program(8,a,0),data:a,loc:{start:{line:5,column:39},end:{line:5,column:113}}}))?o:"")+'" width="32" height="32">\n\t\t\t</div>\n\t\t\t<div class="name-info">\n\t\t\t\t<span class="person-name">\n\t\t\t\t\t'+u(typeof(r=null!=(r=p(e,"displayname")||(null!=l?p(l,"displayname"):l))?r:i)===c?r.call(s,{name:"displayname",hash:{},data:a,loc:{start:{line:9,column:5},end:{line:9,column:20}}}):r)+(null!=(o=p(e,"if").call(s,null!=l?p(l,"isDeleted"):l,{name:"if",hash:{},fn:n.program(10,a,0),inverse:n.noop,data:a,loc:{start:{line:9,column:20},end:{line:9,column:93}}}))?o:"")+"\n\t\t\t\t\t"+(null!=(o=p(e,"if").call(s,null!=l?p(l,"isPro"):l,{name:"if",hash:{},fn:n.program(12,a,0),inverse:n.noop,data:a,loc:{start:{line:10,column:5},end:{line:10,column:91}}}))?o:"")+'\n\t\t\t\t</span>\n\t\t\t\t<span class="username">\n\t\t\t\t\t'+u(typeof(r=null!=(r=p(e,"username")||(null!=l?p(l,"username"):l))?r:i)===c?r.call(s,{name:"username",hash:{},data:a,loc:{start:{line:13,column:5},end:{line:13,column:17}}}):r)+"\n\t\t\t\t</span>\n\t\t\t</div>\n\t\t</div>\n"+(null!=(o=p(e,"if").call(s,null!=l?p(l,"showRemove"):l,{name:"if",hash:{},fn:n.program(14,a,0),inverse:n.noop,data:a,loc:{start:{line:17,column:2},end:{line:19,column:9}}}))?o:"")+"\t</li>\n"},2:function(n,l,e,t,a){return"can-remove-tag"},4:function(n,l,e,t,a){var o,r=n.lambda,s=n.escapeExpression,i=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return"data-"+s(r(null!=(o=null!=l?i(l,"dataAttr"):l)?i(o,"key"):o,l))+'="'+s(r(null!=(o=null!=l?i(l,"dataAttr"):l)?i(o,"value"):o,l))+'"'},6:function(n,l,e,t,a){var o,r=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return n.escapeExpression(n.lambda(null!=(o=null!=l?r(l,"buddyicon"):l)?r(o,"default"):o,l))},8:function(n,l,e,t,a){var o,r=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return n.escapeExpression("function"==typeof(o=null!=(o=r(e,"buddyicon")||(null!=l?r(l,"buddyicon"):l))?o:n.hooks.helperMissing)?o.call(null!=l?l:n.nullContext||{},{name:"buddyicon",hash:{},data:a,loc:{start:{line:5,column:93},end:{line:5,column:106}}}):o)},10:function(n,l,e,t,a){var o=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return" ("+n.escapeExpression((o(e,"intlMessage")||l&&o(l,"intlMessage")||n.hooks.helperMissing).call(null!=l?l:n.nullContext||{},{name:"intlMessage",hash:{intlName:"common.DELETED_USER"},data:a,loc:{start:{line:9,column:39},end:{line:9,column:85}}}))+")"},12:function(n,l,e,t,a){var o,r=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return null!=(o=n.invokePartial(r(t,"pro-badge"),l,{name:"pro-badge",hash:{purchaseProURL:null!=l?r(l,"purchaseProURL"):l,badgeType:null!=l?r(l,"proBadge"):l},data:a,helpers:e,partials:t,decorators:n.decorators}))?o:""},14:function(n,l,e,t,a){return'\t\t\t<svg class="icon icon-check_circle can-remove-tag"><use xlink:href="#icon-check_circle"></use></svg>\n'},16:function(n,l,e,t,a){var o,r,s=null!=l?l:n.nullContext||{},i=n.hooks.helperMissing,c="function",u=n.escapeExpression,p=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return'\t<li class="person" '+(null!=(o=p(e,"if").call(s,null!=l?p(l,"dataAttr"):l,{name:"if",hash:{},fn:n.program(4,a,0),inverse:n.noop,data:a,loc:{start:{line:22,column:20},end:{line:22,column:85}}}))?o:"")+'>\n\t\t<div class="person-icon">\n\t\t\t<a class="'+u(typeof(r=null!=(r=p(e,"extraClasses")||(null!=l?p(l,"extraClasses"):l))?r:i)===c?r.call(s,{name:"extraClasses",hash:{},data:a,loc:{start:{line:24,column:13},end:{line:24,column:29}}}):r)+'" href="/photos/'+u(typeof(r=null!=(r=p(e,"pathAlias")||(null!=l?p(l,"pathAlias"):l))?r:i)===c?r.call(s,{name:"pathAlias",hash:{},data:a,loc:{start:{line:24,column:45},end:{line:24,column:58}}}):r)+'/" data-track="'+u(typeof(r=null!=(r=p(e,"dataTrackPrefix")||(null!=l?p(l,"dataTrackPrefix"):l))?r:i)===c?r.call(s,{name:"dataTrackPrefix",hash:{},data:a,loc:{start:{line:24,column:73},end:{line:24,column:92}}}):r)+'PersonIconClick">\n\t\t\t\t<div class="circle-icon" data-person-nsid="'+u(typeof(r=null!=(r=p(e,"nsid")||(null!=l?p(l,"nsid"):l))?r:i)===c?r.call(s,{name:"nsid",hash:{},data:a,loc:{start:{line:25,column:47},end:{line:25,column:55}}}):r)+'">\n\t\t\t\t\t<img class="show-person-menu" src="'+(null!=(o=p(e,"if").call(s,null!=(o=null!=l?p(l,"buddyicon"):l)?p(o,"default"):o,{name:"if",hash:{},fn:n.program(6,a,0),inverse:n.program(8,a,0),data:a,loc:{start:{line:26,column:40},end:{line:26,column:114}}}))?o:"")+'" width="32" height="32">\n\t\t\t\t</div>\n\t\t\t\t<span class="person-name">\n\t\t\t\t\t'+u(typeof(r=null!=(r=p(e,"displayname")||(null!=l?p(l,"displayname"):l))?r:i)===c?r.call(s,{name:"displayname",hash:{},data:a,loc:{start:{line:29,column:5},end:{line:29,column:20}}}):r)+(null!=(o=p(e,"if").call(s,null!=l?p(l,"isDeleted"):l,{name:"if",hash:{},fn:n.program(10,a,0),inverse:n.noop,data:a,loc:{start:{line:29,column:20},end:{line:29,column:93}}}))?o:"")+"\n\t\t\t\t</span>"+(null!=(o=p(e,"if").call(s,null!=l?p(l,"isPro"):l,{name:"if",hash:{},fn:n.program(12,a,0),inverse:n.noop,data:a,loc:{start:{line:30,column:11},end:{line:30,column:97}}}))?o:"")+"\n\t\t\t</a>\n"+(null!=(o=p(e,"if").call(s,null!=l?p(l,"showRemove"):l,{name:"if",hash:{},fn:n.program(17,a,0),inverse:n.noop,data:a,loc:{start:{line:32,column:3},end:{line:34,column:10}}}))?o:"")+"\t\t</div>\n\t</li>\n"},17:function(n,l,e,t,a){return'\t\t\t<a class="remove-person hide-text ui-icon-comment-delete" href="#">x</a>\n'},compiler:[8,">= 4.3.0"],main:function(n,l,e,t,a){var o,r=n.lookupProperty||function(n,l){if(Object.prototype.hasOwnProperty.call(n,l))return n[l]};return null!=(o=r(e,"if").call(null!=l?l:n.nullContext||{},null!=l?r(l,"isTagsModalList"):l,{name:"if",hash:{},fn:n.program(1,a,0),inverse:n.program(16,a,0),data:a,loc:{start:{line:1,column:0},end:{line:37,column:7}}}))?o:""},usePartial:!0,useData:!0}),t={};n.Array.each(["pro-badge","pro-badge"],(function(l){var e=n.Template.get("hermes/"+l);e&&(t[l]=e)})),n.Template.register("hermes/sub-photo-person",(function(l,a){return(a=a||{}).partials=a.partials?n.merge(t,a.partials):t,e(l,a)}))}),"@VERSION@",{requires:["template-base","handlebars-base","hermes-template-pro-badge","hermes-template-pro-badge"]});YUI.add("hermes-template-invite-person",(function(e,n){var l=e.Template.Handlebars.revive({1:function(e,n,l,t,a){var i,r=e.lambda,o=e.escapeExpression,s=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return"data-"+o(r(null!=(i=null!=n?s(n,"dataAttr"):n)?s(i,"key"):i,n))+'="'+o(r(null!=(i=null!=n?s(n,"dataAttr"):n)?s(i,"value"):i,n))+'"'},3:function(e,n,l,t,a){return'\t\t<a class="remove-person hide-text ui-icon-comment-delete" href="#">x</a>\n'},compiler:[8,">= 4.3.0"],main:function(e,n,l,t,a){var i,r,o=null!=n?n:e.nullContext||{},s=e.hooks.helperMissing,c="function",u=e.escapeExpression,m=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return'<li class="person" '+(null!=(i=m(l,"if").call(o,null!=n?m(n,"dataAttr"):n,{name:"if",hash:{},fn:e.program(1,a,0),inverse:e.noop,data:a,loc:{start:{line:1,column:19},end:{line:1,column:84}}}))?i:"")+'>\n\t<div class="person-icon">\n\t\t<div class="circle-icon">\n\t\t\t<img src="https://combo.staticflickr.com/pw/images/icon_unread.gif" width="'+u(typeof(r=null!=(r=m(l,"size")||(null!=n?m(n,"size"):n))?r:s)===c?r.call(o,{name:"size",hash:{},data:a,loc:{start:{line:4,column:78},end:{line:4,column:86}}}):r)+'" height="'+u(typeof(r=null!=(r=m(l,"size")||(null!=n?m(n,"size"):n))?r:s)===c?r.call(o,{name:"size",hash:{},data:a,loc:{start:{line:4,column:96},end:{line:4,column:104}}}):r)+'">\n\t\t</div>\n\t\t<p class="person-name">\n\t\t'+u(typeof(r=null!=(r=m(l,"email")||(null!=n?m(n,"email"):n))?r:s)===c?r.call(o,{name:"email",hash:{},data:a,loc:{start:{line:7,column:2},end:{line:7,column:11}}}):r)+"\n\t\t</p>\n"+(null!=(i=m(l,"if").call(o,null!=n?m(n,"showRemove"):n,{name:"if",hash:{},fn:e.program(3,a,0),inverse:e.noop,data:a,loc:{start:{line:9,column:2},end:{line:11,column:9}}}))?i:"")+"\t</div>\n</li>\n"},useData:!0}),t={};e.Array.each([],(function(n){var l=e.Template.get("hermes/"+n);l&&(t[n]=l)})),e.Template.register("hermes/invite-person",(function(n,a){return(a=a||{}).partials=a.partials?e.merge(t,a.partials):t,l(n,a)}))}),"@VERSION@",{requires:["template-base","handlebars-base"]});YUI.add("hermes-template-sub-photo-tags-people-section",(function(e,n){var t=e.Template.Handlebars.revive({1:function(e,n,t,a,l){var r=null!=n?n:e.nullContext||{},o=e.hooks.helperMissing,s=e.escapeExpression,p=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return'    <a href="#" class="show-add-people">'+s((p(t,"intlMessage")||n&&p(n,"intlMessage")||o).call(r,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.ADD_PEOPLE"},data:l,loc:{start:{line:4,column:40},end:{line:4,column:96}}}))+'</a>\n\t<input type ="text" class="add-person" placeholder="'+s((p(t,"intlMessage")||n&&p(n,"intlMessage")||o).call(r,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.ADD_PERSON"},data:l,loc:{start:{line:5,column:53},end:{line:5,column:109}}}))+'">\n'},3:function(e,n,t,a,l,r,o){var s,p=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return null!=(s=p(t,"if").call(null!=n?n:e.nullContext||{},null!=n?p(n,"person"):n,{name:"if",hash:{},fn:e.program(4,l,0,r,o),inverse:e.program(6,l,0,r,o),data:l,loc:{start:{line:10,column:2},end:{line:14,column:9}}}))?s:""},4:function(e,n,t,a,l,r,o){var s,p=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return null!=(s=e.invokePartial(p(a,"sub-photo-person"),null!=n?p(n,"person"):n,{name:"sub-photo-person",hash:{purchaseProURL:null!=o[1]?p(o[1],"purchaseProURL"):o[1]},data:l,indent:"\t\t\t",helpers:t,partials:a,decorators:e.decorators}))?s:""},6:function(e,n,t,a,l){var r,o=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return null!=(r=e.invokePartial(o(a,"invite-person"),null!=n?o(n,"invite"):n,{name:"invite-person",data:l,indent:"\t\t\t",helpers:t,partials:a,decorators:e.decorators}))?r:""},compiler:[8,">= 4.3.0"],main:function(e,n,t,a,l,r,o){var s,p=null!=n?n:e.nullContext||{},i=e.lookupProperty||function(e,n){if(Object.prototype.hasOwnProperty.call(e,n))return e[n]};return'<h3 tabindex="0">'+e.escapeExpression((i(t,"intlMessage")||n&&i(n,"intlMessage")||e.hooks.helperMissing).call(p,{name:"intlMessage",hash:{intlName:"photo-page-scrappy.PEOPLE_IN_PHOTO"},data:l,loc:{start:{line:1,column:17},end:{line:1,column:78}}}))+"</h3>\n\n"+(null!=(s=i(t,"if").call(p,null!=n?i(n,"canAddMeta"):n,{name:"if",hash:{},fn:e.program(1,l,0,r,o),inverse:e.noop,data:l,loc:{start:{line:3,column:0},end:{line:6,column:7}}}))?s:"")+'\n<div class="person-list">\n'+(null!=(s=i(t,"each").call(p,null!=n?i(n,"people"):n,{name:"each",hash:{},fn:e.program(3,l,0,r,o),inverse:e.noop,data:l,loc:{start:{line:9,column:1},end:{line:15,column:10}}}))?s:"")+'</div>\n\n<div style="clear:both;"></div>\n'},usePartial:!0,useData:!0,useDepths:!0}),a={};e.Array.each(["sub-photo-person","invite-person"],(function(n){var t=e.Template.get("hermes/"+n);t&&(a[n]=t)})),e.Template.register("hermes/sub-photo-tags-people-section",(function(n,l){return(l=l||{}).partials=l.partials?e.merge(a,l.partials):a,t(n,l)}))}),"@VERSION@",{requires:["template-base","handlebars-base","hermes-template-sub-photo-person","hermes-template-invite-person"]});YUI.add("sub-photo-tags-people-view",(function(e,t){var o=require("hermes-core/flog")(t),n=new e.SubscriptionsHelper;e.FlickrView.create(this.name,e.FlickrView,[],{langBundles:this.details.langBundles,initializer:function(t){return this.photoId=t.photoId,this.context=e.clone(t.context,!0),""===this.get("container").get("innerHTML")&&this.setContainerHTML(""),this._css={locked:"ui-util-locked",working:"ui-util-working",removed:"ui-util-removed",shim:"c-contact-search-shim"},this},loadState:function(){var t=this;return new e.FlickrPromise({photo:this.appContext.getModel("photo-models",this.photoId),photoPeople:this.appContext.getModel("photo-people-models",this.photoId),peopleModel:this.appContext.getModelRegistry("person-in-photo-models"),person:this.appContext.getModelRegistry("person-models")}).then((function(e){t.set("photo",e.photo),t.set("photoPeople",e.photoPeople),t.set("peopleModel",e.peopleModel),t.set("person",e.person)})).then((function(){var e=t.appContext.getViewer();if(e.signedIn)return t.get("person").get(e.nsid).then((function(e){t.set("me",e)}))}))},buildContainer:function(){var e,t=this.get("photo"),o=this.get("photoPeople").getValue("people"),a=t.getValue("isOwner")||t.getValue("canAddMeta"),s=t.getValue("isOwner"),i=this,r=!1;return o&&(0===(e=o.toJSON()).length&&a&&(r=!0,this.get("container").addClass("empty"),this.fire("subviewViewEvent","tagsPeopleView:peopleEmpty")),e.forEach((function(e){e.person?(e.person.size=32,e.person.showRemove=i.canRemoveTag(s,i.appContext.getViewer().nsid,e.addedBy,e.person.nsid),e.person.dataAttr={key:"person-nsid",value:e.person.nsid}):(e.invite={size:32,email:e.email},e.invite.showRemove=i.canRemoveTag(s,i.appContext.getViewer().nsid,e.addedBy,null),e.invite.dataAttr={key:"person-tag-email",value:e.invite.email})})),e=e.sort((function(e,t){return e.invite&&t.person?-1:e.person&&t.invite?1:e.person&&t.person&&e.person.displayname.toUpperCase()<t.person.displayname.toUpperCase()?-1:e.person&&t.person&&e.person.displayname.toUpperCase()>t.person.displayname.toUpperCase()?1:e.invite&&t.invite&&e.invite.email&&t.invite.email&&e.invite.email.toUpperCase()<t.invite.email.toUpperCase()?-1:e.invite&&t.invite&&e.invite.email&&t.invite.email&&e.invite.email.toUpperCase()>t.invite.email.toUpperCase()?1:0}))),a||e.length>0?this.setContainerWithTemplate("sub-photo-tags-people-section",{people:e,canAddMeta:a,emptyPeopleTags:r,purchaseProURL:n.getProLandingPageUrl(n.UTM_PRO_BADGE,{utm_medium:this.name})}):this.setContainerHTML(""),this},focusTag:function(){var e=this.get("container").one(".add-person");e&&e.focus()},activate:function(){var t=this.get("container"),o=t.one(".add-person"),n=this.get("photoPeople")?this.get("photoPeople").getValue("people"):null,a=[],s=this;return t.one(".show-add-people")&&(this.appContext.flipper.isFlipped("enable-responsive-mobile-photo-page")?this.registerEventHandler(t.one(".show-add-people").on("click",this.showAddPeopleModal.bind(this))):(this.registerEventHandler(t.one(".show-add-people").on("click",(function(e){e.preventDefault(),t.hasClass("empty")&&(t.removeClass("empty"),s.fire("subviewViewEvent","tagsPeopleView:peopleNotEmpty")),t.one(".c-contact-search-autocomplete").setStyle("display","block"),t.one(".add-person").setStyle("display","block"),t.one(".add-person").focus()}))),this.attachKeyEvent("down:80",(function(o){o.preventDefault();var n=t.one(".add-person");try{t.hasClass("empty")&&(t.removeClass("empty"),s.fire("subviewViewEvent","tagsPeopleView:peopleNotEmpty")),t.one(".c-contact-search-autocomplete").setStyle("display","block"),n.setStyle("display","block"),n.focus(),e.AnchorRepositioner.jumpTo(t)}catch(e){}})))),this.focus&&(setTimeout((function(){o.focus()}),100),this.focus=!1),o&&(n&&(a=n.getList()),this.arrow=e.Node.create('<span class="ui-dialog-arrow contact-autocomplete-arrow"></span>'),this.contacts=new e.ContactSearchBox({el:o,appContext:this.appContext,shim:this._css.shim,elValue:"value",signedOut:!1,canTag:1,noShim:!0,searchNonContacts:!0,loadMoreOnScroll:!0,upInitially:!1,alwaysDownward:!0,loadingState:this.templates(e.Balls())(),max:1e3,hideInitially:a.map((function(e){return e.id})),me:this.get("me"),onError:function(){o.blur(),s.contacts.hide(),new e.Views.FluidModal({appContext:s.appContext,title:s.intlMessage({intlName:"common.ERROR"}),message:s.intlMessage({intlName:"photo-page-scrappy.CONTACT_LIST_ERROR"}),actionButtonLabel:s.intlMessage({intlName:"common.OK"}),showCancelButton:!1}).show()},onShow:function(n){var a=o.ancestor(".c-contact-search-autocomplete");s.arrow||(s.arrow=e.Node.create('<span class="ui-dialog-arrow contact-autocomplete-arrow"></span>')),s.arrow.inDoc()||a.appendChild(s.arrow),s.arrow.removeClass("hide"),t.addClass(s._css.locked)},onSelect:function(e){e?t.removeClass(s._css.locked):t.addClass(s._css.locked)},onHide:function(){var e=o;s.arrow.addClass("hide"),e.setHTML("")},onOrientationChange:function(e){s.arrow&&(e?s.arrow.addClass("upside-down"):s.arrow.removeClass("upside-down"))},clickContact:function(t,n){var a,i,r,p,l,d;e.UA.ie&&document.getSelection()&&"content"===document.getSelection().anchorNode.id||(o.removeClass("focused"),o.setHTML(""),s.contacts.abort=!0,s.hideDropdown=setTimeout((function(){s.contacts.hide()}),150),(a=n?n.ancestor("[data-nsid]",!0):t.target.ancestor("[data-nsid]",!0))?(i=a.getData("nsid"),p=a.one("img").get("src"),r=a.getData("displayname")||"",l=a.getData("path-alias"),d="true"===a.getData("ispro"),s.addTemporaryPersonTag(r,i,p,l,d),s.addRemotePersonTag(i),s.contacts.hideFromSearch(i),s.contacts.hide(),s.contacts.abort=!0,s.get("container").one(".add-person").set("value",""),s.get("container").one(".add-person").focus()):s.contacts.hide())}}),this.registerEventHandler(o.on("focus",(function(t){var o=this;t.preventDefault(),this.addClass("focused"),s.contacts.abort=!1,setTimeout((function(){e.UA.ie&&(o.addClass("focused"),o.focus()),o.set("text","")}),40)}))),this.registerEventHandler(o.on("keydown",(function(e){13===e.keyCode&&(e.halt(),clearTimeout(s.hideDropdown),o.focus())}))),this.registerEventHandler(o.on("blur",(function(e){this.removeClass("focused")}))),this.registerEventHandler(o.ancestor(".c-contact-search-autocomplete").on("focus",(function(e){e.target.hasClass("c-contact-search-autocomplete")&&(clearTimeout(s.hideDropdown),o.focus())})))),t.one(".person-list")&&this.registerEventHandler(t.one(".person-list").on("click",(function(e){e.target.hasClass("remove-person")?s.removeTag(e):e.target.ancestor("[data-loading]")&&e.preventDefault()}))),this},removeTag:function(e){e.preventDefault();var t,n,a=e.target.ancestor("[data-person-nsid]"),s=e.target.ancestor("[data-person-tag-email]"),i=this.get("photoPeople").getValue("people");a?(t=a.getData("person-nsid"),a.setAttribute("data-loading",t),i.removeFromList(t,"id"),this.remoteRemoveTag(t),this.contacts.showInSearch(t)):s?(n=s.getData("person-tag-email"),s.setAttribute("data-loading",n),i.removeFromList(n,"email"),this.remoteRemoveTag(null,n)):o.warn("tried to remove invalid person tag.")},remoteRemoveTag:function(e,t){var o=this.get("container"),n=o.one(".person-list"),a=e?"userId":"email",s=e||t,i=this,r={photoId:this.photoId,coords:{x:0,y:0,w:0,h:0}};r[a]=s,this.get("peopleModel").remoteDelete(r).then((function(){var a=e?n.one('[data-person-nsid="'+e+'"]'):n.one('[data-person-tag-email="'+t+'"]');a&&a.remove(!0),n.one("li")||(o.one(".c-contact-search-autocomplete").setStyle("display","none"),o.addClass("empty"),i.fire("subviewViewEvent","tagsPeopleView:peopleEmpty"))}),(function(e){i.onError(i.intlMessage({intlName:"photo-page-scrappy.FAILED_TO_REMOVE_PERSON"}))}))},addTemporaryPersonTag:function(e,t,o,n,a){this.addPerson({dataAttr:{key:"loading",value:t},buddyicon:o,size:50,displayname:e,isPro:a,pathAlias:n||t,nsid:t,showRemove:!0})},addPerson:function(e){var t,o=this.get("container").one(".person-list");t=this.templates("sub-photo-person")(e),o.prepend(t)},addRemotePersonTag:function(e){var t=this.get("container").one(".person-list"),o=this,n=this.get("photoPeople")?this.get("photoPeople").getValue("people"):null;this.get("peopleModel").remoteCreate({photoId:this.photoId,userId:e,addedBy:o.get("me").getValue("nsid"),coords:{x:0,y:0,w:0,h:0}}).then((function(a){var s,i=t.one('[data-loading="'+e+'"]');i&&(i.removeAttribute("data-loading"),i.setAttribute("data-person-nsid",e)),s=o.get("peopleModel").add(a),n&&n.appendToList(s)}),(function(){t.one('[data-loading="'+e+'"]').remove(!0),o.onError(o.intlMessage({intlName:"photo-page-scrappy.PERSON_CANNOT_BE_TAGGED"}))}))},canRemoveTag:function(e,t,o,n){return e||t&&o===t||n&&n===t},onError:function(t){new e.Views.FluidModal({appContext:this.appContext,title:this.intlMessage({intlName:"common.ERROR"}),message:t,actionButtonLabel:this.intlMessage({intlName:"common.OK"}),showCancelButton:!1}).show()},showAddPeopleModal:function(){let t=new e.Views["sub-photo-add-tags-view"]({title:"Add people TMP",showCloseXButton:!0,isPersonTag:!0,isTagsModalList:!0});new e.Views.FluidModal({appContext:this.appContext,subview:t,hasSubviewConfigRefactor:!0}).show()}})}),"@VERSION@",{requires:["flickr-view","hermes-template-sub-photo-person","hermes-template-invite-person","hermes-template-sub-photo-tags-people-section","sub-photo-add-tags-view","url-helper","contact-search-box","html5-balls","subscriptions-helper"],optionalRequires:["hermes-core"],langBundles:["common","photo-page-scrappy"]});